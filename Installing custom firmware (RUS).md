# Установка другой прошивки на Micromake D1

_Внимание_ - в качестве примера для этой инструкции используется плата Micromake первого поколения. Перемычкой на плате у меня установлен режим 32 steps. Настройки вашей платы могут отличаться. В качестве средства для отправки команд принтеру я использую Repetier Host. Если вы используете штатную программу CURA, ваши шаги будут немного отличаться.

Основная плата принтера Micromake - это переделанная Arduino Mega. Процессор тот же, основное отличие - только в том, что на плату добавили драйверы для шаговых моторов и силовые ключи для нагревательного элемента и хотбеда. Как и в любой Ардуине, в плату можно загрузить новую программу с компьютера через USB-шнур.

Для загрузки новой программы вам понадобится оболочка "Arduino IDE". Её можно бесплатно скачать с https://www.arduino.cc/en/Main/Software (вам нужна ссылка "Windows installer"). Скачайте программу и установите.

Далее - вам понадобится исходный код прошивки для принтера. Micromake работает на прошивке "Repetier" отсюда - https://github.com/repetier/Repetier-Firmware К сожалению, просто так взять её и накатить на принтер не получится - во-первых, она требует "доводки напильником" под наш принтер, во-вторых, будет не хватать добавленных китайцами дополнений.

Самый простой вариант - взять мой вариант прошивки с *URL*. Он сделан на базе бета-версии прошивки Repetier 1.0dev и кое-как работает. Или берите прошивку из официального хранилища Micromake на Гугл-диске - https://drive.google.com/drive/folders/0B1DQUrzkDP-tNDU0NXhVcGhlc0k (файл `Micromake D1.zip`).

Распакуйте файлы в любое место на диске - главное, чтобы папка с файлами имела имя `Repetier`. Например, пусть будет `c:\Repetier`. Откройте файл `Repetier.ino`.

Подключите плату USB-кабелем. В меню Arduino IDE `Tools` - `Board` выберите `Arduino/Genuino MEGA or MEGA 2560`. В меню `Tools` - `Port` выберите порт, который Windows присвоила подключённой плате. Уточнить его можно через "Диспетчер устройств" Windows.

Чтобы проверить, что всё скачано верно, нажмите `Ctrl+R`. В окне внизу побегут команды, и где-то через 10-15 секунд вы увидите сообщение `Done compining`, а внизу - отчёт вида 

    Sketch uses 137,236 bytes (54%) of program storage space. Maximum is 253,952 bytes.
    Global variables use 6,984 bytes (85%) of dynamic memory, leaving 1,208 bytes for local variables. Maximum is 8,192 bytes.
    Low memory available, stability problems may occur.

Это означает, что вы правильно установили Arduino IDE и правильно скачали прошивку.

## Настраиваем прошивку

В окне Arduino IDE будет много вкладок - по одной на каждый файл прошивки. Найдите вкладку с файлом `Commands.cpp` (не путайте с `Commands.h`!). Найдите строки:

    case 30:
        { // G30 single probe set Z0
            uint8_t p = (com->hasP() ? (uint8_t)com->P : 3);

вам нужно заменить `P : 3` на `P : 2`, то есть у вас получится:


    case 30:
        { // G30 single probe set Z0
            uint8_t p = (com->hasP() ? (uint8_t)com->P : 2);

